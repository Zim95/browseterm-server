<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>{% block title %}BrowseTerm{% endblock %}</title>

    <!-- Apply dark mode immediately to prevent flash -->
    <script>
        (function() {
            const savedTheme = localStorage.getItem('theme');

            // Set default to 'light' if no preference is saved
            if (!savedTheme) {
                localStorage.setItem('theme', 'light');
            }

            // Only apply dark mode if explicitly saved as 'dark'
            if (savedTheme === 'dark') {
                document.documentElement.classList.add('dark-mode-loading');
            }
        })();

        // Define global toggle function immediately (before base.js loads)
        window.toggleDarkModeGlobal = function() {
            console.log('Global dark mode toggle called from inline script!');
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');

            // Save preference to localStorage
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');

            console.log('Dark mode toggled:', isDarkMode ? 'enabled' : 'disabled');

            // Add a smooth transition effect
            document.body.style.transition = 'background-color 0.3s ease, color 0.3s ease';
            setTimeout(function() {
                document.body.style.transition = '';
            }, 300);
        };
    </script>

    <link rel="stylesheet" href="{{ url_for('static', path='/css/base.css') }}">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <span class="logo-text">BrowseTerm</span>
            </div>
            <button class="hamburger" id="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>

        <div class="sidebar-menu">
            <ul class="menu-items">
                <li class="menu-item">
                    <a href="/" class="menu-link {% if request.url.path == '/' %}active{% endif %}">
                        <span class="menu-icon">üè†</span>
                        <span class="menu-text">Home</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="/terminals" class="menu-link {% if request.url.path == '/terminals' %}active{% endif %}">
                        <span class="menu-icon">üíª</span>
                        <span class="menu-text">Terminals</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="/subscriptions" class="menu-link {% if request.url.path == '/subscriptions' %}active{% endif %}">
                        <span class="menu-icon">üí∞</span>
                        <span class="menu-text">Subscriptions</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="/profile" class="menu-link {% if request.url.path == '/profile' %}active{% endif %}">
                        <span class="menu-icon">üë§</span>
                        <span class="menu-text">Profile</span>
                    </a>
                </li>
            </ul>
        </div>

        <div class="sidebar-footer">
            <button class="logout-btn" id="logoutBtn">
                <span class="logout-icon">‚èª</span>
                <span class="logout-text">Logout</span>
            </button>
        </div>
    </nav>

    <!-- Floating Mobile Menu Button -->
    <button class="mobile-menu-btn" id="mobileMenuBtn">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <!-- Dark Mode Toggle -->
    <button class="dark-mode-toggle" id="darkModeToggle" aria-label="Toggle dark mode" onclick="window.toggleDarkModeGlobal && window.toggleDarkModeGlobal()">
        <span class="sun-icon">‚òÄÔ∏è</span>
        <span class="moon-icon">üåô</span>
    </button>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        {% block content %}{% endblock %}
    </main>

    <!-- Notification Container -->
    <div id="notificationContainer" class="notification-container"></div>

    <script src="{{ url_for('static', path='/js/base.js') }}?v=2"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>
